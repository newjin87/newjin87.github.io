<div class="book-summary">
    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="{{site.baseurl}}/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            {% if page.url == "/index.html" or page.url == "/" %}
            <li class="chapter active" data-level="1.1" data-path="{{site.baseurl}}">
            {% else %}
            <li class="chapter" data-level="1.1" data-path="{{site.baseurl}}">
            {% endif %}
                <a href="{{site.baseurl}}/">
                    {{ site.title | escape }}
                </a>
            </li>

            <li class="divider"></li>

            {% comment %} Ìè¥Îçî Í∏∞Î∞ò Í∑∏Î£πÌôî {% endcomment %}
            {% assign all_folders = "" | split: "" %}
            {% for post in site.posts %}
                {% assign folder_path = post.path | split: "/" %}
                {% if folder_path.size > 2 %}
                    {% assign folder_name = folder_path[1] | split: "." %}
                    {% if folder_name.size > 1 %}
                        {% assign folder_number = folder_name[0] %}
                        {% assign folder_title = folder_name[1] | strip %}
                        {% assign folder_info = folder_number | append: "::" | append: folder_title %}
                        {% assign all_folders = all_folders | push: folder_info %}
                    {% endif %}
                {% endif %}
            {% endfor %}
            
            {% assign unique_folders = all_folders | uniq | sort %}

            {% comment %} Ïπ¥ÌÖåÍ≥†Î¶¨ Í∏∞Î∞ò Í∑∏Î£πÌôî {% endcomment %}
            {% assign all_categories = "" | split: "" %}
            {% for post in site.posts %}
                {% assign folder_path = post.path | split: "/" %}
                {% if folder_path.size <= 2 and post.categories %}
                    {% for category in post.categories %}
                        {% assign all_categories = all_categories | push: category %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
            
            {% assign unique_categories = all_categories | uniq | sort %}

            {% comment %} Ìè¥ÎçîÎ≥ÑÎ°ú Ìè¨Ïä§Ìä∏ ÌëúÏãú {% endcomment %}
            {% for folder_info in unique_folders %}
                {% assign folder_parts = folder_info | split: "::" %}
                {% assign folder_number = folder_parts[0] %}
                {% assign folder_title = folder_parts[1] %}
                
                <li class="chapter">
                    <a class="folder-toggle" href="#" data-folder="{{ folder_number }}">
                        <i class="fa fa-angle-right"></i> 
                        üìÅ {{ folder_number }}. {{ folder_title }}
                    </a>
                    <ul class="folder-posts" id="folder-{{ folder_number }}" style="display: none;">
                        {% for post in site.posts %}
                            {% assign post_folder_path = post.path | split: "/" %}
                            {% if post_folder_path.size > 2 %}
                                {% assign post_folder = post_folder_path[1] | split: "." %}
                                {% if post_folder.size > 1 and post_folder[0] == folder_number %}
                                    {% if page.url == post.url %}
                                    <li class="chapter active" data-level="1.2" data-path="{{site.baseurl}}{{post.url}}">
                                    {% else %}
                                    <li class="chapter" data-level="1.1" data-path="{{site.baseurl}}{{post.url}}">
                                    {% endif %}
                                        <a href="{{site.baseurl}}{{post.url}}">
                                            {{ post.title | escape }}
                                        </a>
                                    </li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}

            {% comment %} Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ìè¨Ïä§Ìä∏ ÌëúÏãú {% endcomment %}
            {% for category in unique_categories %}
                <li class="chapter">
                    <a class="category-toggle" href="#" data-category="{{ category }}">
                        <i class="fa fa-angle-right"></i> 
                        üè∑Ô∏è {{ category }}
                    </a>
                    <ul class="category-posts" id="category-{{ category }}" style="display: none;">
                        {% for post in site.posts %}
                            {% assign folder_path = post.path | split: "/" %}
                            {% if folder_path.size <= 2 and post.categories contains category %}
                                {% if page.url == post.url %}
                                <li class="chapter active" data-level="1.2" data-path="{{site.baseurl}}{{post.url}}">
                                {% else %}
                                <li class="chapter" data-level="1.1" data-path="{{site.baseurl}}{{post.url}}">
                                {% endif %}
                                    <a href="{{site.baseurl}}{{post.url}}">
                                        {{ post.title | escape }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}

            <li class="divider"></li>

            <li>
                <a href="https://github.com/sighingnow/jekyll-gitbook/fork" target="blank" class="gitbook-link">
                    Fork it Now!
                </a>
            </li>
        </ul>
    </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var toggles = document.getElementsByClassName('folder-toggle');
    var categoryToggles = document.getElementsByClassName('category-toggle');
    
    function addToggleListener(elements, type) {
        for (var i = 0; i < elements.length; i++) {
            elements[i].addEventListener('click', function(e) {
                e.preventDefault();
                var id = this.getAttribute('data-' + type);
                var postsList = document.getElementById(type + '-' + id);
                var icon = this.querySelector('i');
                
                if (postsList.style.display === 'none') {
                    postsList.style.display = 'block';
                    icon.className = 'fa fa-angle-down';
                } else {
                    postsList.style.display = 'none';
                    icon.className = 'fa fa-angle-right';
                }
            });
        }
    }
    
    addToggleListener(toggles, 'folder');
    addToggleListener(categoryToggles, 'category');
});
</script>
