<div class="book-summary">
    <nav role="navigation">
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search" />
        </div>
        <div id="book-search-input-link" role="search">
            <a href="{{site.baseurl}}/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            {% if page.url == "/index.html" or page.url == "/" %}
            <li class="chapter active" data-level="1.1" data-path="{{site.baseurl}}">
            {% else %}
            <li class="chapter" data-level="1.1" data-path="{{site.baseurl}}">
            {% endif %}
                <a href="{{site.baseurl}}/">
                    {{ site.title | escape }}
                </a>
            </li>

            <li class="divider"></li>

            {% comment %} Î™®Îì† Ìè¥ÎçîÏôÄ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàòÏßë {% endcomment %}
            {% assign all_groups = "" | split: "" %}
            
            {% comment %} posts Ïª¨Î†âÏÖò Ï≤òÎ¶¨ {% endcomment %}
            {% for post in site.posts %}
                {% assign folder_path = post.path | split: "/" %}
                {% if folder_path.size > 2 %}
                    {% assign group = folder_path[1] %}
                    {% assign group_type = "folder" %}
                {% elsif post.category %}
                    {% assign group = post.category %}
                    {% assign group_type = "category" %}
                {% else %}
                    {% assign group = "Í∏∞ÌÉÄ" %}
                    {% assign group_type = "category" %}
                {% endif %}
                {% assign group_info = group | append: "::" | append: group_type %}
                {% assign all_groups = all_groups | push: group_info %}
            {% endfor %}
            
            {% assign unique_groups = all_groups | uniq | sort %}

            {% comment %} Ìè¥Îçî/Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ìè¨Ïä§Ìä∏ ÌëúÏãú {% endcomment %}
            {% for group_info in unique_groups %}
                {% assign group_parts = group_info | split: "::" %}
                {% assign group = group_parts[0] %}
                {% assign group_type = group_parts[1] %}
                
                <li class="chapter">
                    <a class="group-toggle" href="#" data-group="{{ group }}" data-type="{{ group_type }}">
                        <i class="fa fa-angle-right"></i> 
                        {% if group_type == "folder" %}
                            üìÅ {{ group }}
                        {% else %}
                            üè∑Ô∏è {{ group }}
                        {% endif %}
                    </a>
                    <ul class="group-posts" id="group-{{ group }}" style="display: none;">
                        {% for post in site.posts %}
                            {% assign show_post = false %}
                            {% assign folder_path = post.path | split: "/" %}
                            
                            {% if group_type == "folder" and folder_path.size > 2 and folder_path[1] == group %}
                                {% assign show_post = true %}
                            {% elsif group_type == "category" %}
                                {% if folder_path.size <= 2 %}
                                    {% if post.category == group or (group == "Í∏∞ÌÉÄ" and post.category == nil) %}
                                        {% assign show_post = true %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}

                            {% if show_post %}
                                {% if page.url == post.url %}
                                <li class="chapter active" data-level="1.2" data-path="{{site.baseurl}}{{post.url}}">
                                {% else %}
                                <li class="chapter" data-level="1.1" data-path="{{site.baseurl}}{{post.url}}">
                                {% endif %}
                                    <a href="{{site.baseurl}}{{post.url}}">
                                        {{ post.title | escape }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}

            <li class="divider"></li>

            <li>
                <a href="https://github.com/sighingnow/jekyll-gitbook/fork" target="blank" class="gitbook-link">
                    Fork it Now!
                </a>
            </li>
        </ul>
    </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var toggles = document.getElementsByClassName('group-toggle');
    
    for (var i = 0; i < toggles.length; i++) {
        toggles[i].addEventListener('click', function(e) {
            e.preventDefault();
            var group = this.getAttribute('data-group');
            var postsList = document.getElementById('group-' + group);
            var icon = this.querySelector('i');
            
            if (postsList.style.display === 'none') {
                postsList.style.display = 'block';
                icon.className = 'fa fa-angle-down';
            } else {
                postsList.style.display = 'none';
                icon.className = 'fa fa-angle-right';
            }
        });
    }
});
</script>
